<html>
    <head>
        <link rel="stylesheet" href="../static/styles/bootstrap.min.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        
        <link rel="stylesheet" href="../static/styles/main.css">
        
        <!-- AUTOFILL -->
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    </head>
    <body>
        <!-- AUTOFILL -->
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <!-- bootstrap -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>

        <!-- HEADER  -->
        <header>
            <h1 class='title'>
                {{ name }}
            </h1>
            <h4 class='subheader'>
                {{ netid }}
            </h4>
        </header>
        
        <!-- BODY CONTENT -->
        <div class='content container'>
            <!-- input -->
            <div class="form-inline global-search">

                <!-- AUTOFILL https://bootsnipp.com/snippets/0Bn1j -->
                <div class="container">
                    <div class="row">
                        <div class="ui-widget">
                            <label>Procedure: </label>
                            <select id="combobox">
                                <option></option>
                                {% for proper_name, backend_name in proper_to_backend_dict.items() %}
                                    <option value='{{backend_name}}'>{{proper_name}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <!-- AUTOFILL CODE END -->

                <button id="search-btn" class="btn btn-info"> 
                    BRING IT! 
                </button>
            </div>
        
            <!-- output -->
            <div id='output-container'>
                <div id='results'>
                    <h2 id='output-msg' class='ennio-font'>
                        Because you like <i>{{query_title}}</i>, you might also like:
                    </h2>
                    {% for dictitem in data_list_dicts %}  
                        <div class='row'>
                            <div class='col-sm'><img src="{{dictitem.img_name}}" alt="{{dictitem.name}}"></div>
                            <div class='col-sm'>{{dictitem.name}}</div>
                            <div class='col-sm'>Composed by {{dictitem.composer}}</div>
                        </div>
                      
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- jquery 3.4.0 -->
        <script type="text/javascript" src="../static/scripts/jquery-3.4.0.min.js"></script>
        
        <!-- steph -->
        <script type="text/javascript" language="javascript">
            var outputMessage = document.getElementById("output-msg");
            outputMessage.style.display = 'none';
            outputMessage.style.fontFamily = 'ennio';

            $('#search-btn').click(function(){
                console.log('clicked');
                query = document.getElementById('combobox').value;
                // query = $("#combobox option:selected").text();
                console.log('query');

                if(query) {
                    $( document ).ajaxError(function( event, request, settings ) {
                        $( "#output-container" ).html( "<p id='error-msg'>We couldn't find '" + decodeURIComponent(query) + "'... try again!</p>" );
                    });
                    // show output message
                    outputMessage.style.display = 'block';

                    query = encodeURIComponent(query.trim())
                    console.log(query)
                    let url = window.location.href + '?search=' + query;
                    
                    $('#output-container').load(url + ' #results');
                } else {
                    outputMessage.style.display = 'none';
                }
            });

            // let comboboxInput = document.getElementsByClassName("custom-combobox-input")[0]

            // $(comboboxInput).keypress(function(e){
            //     console.log('yeet');
            //     if(e.which == 13){//Enter key pressed
            //         $('#search-btn').click();//Trigger search button click event
            //     }
            // });

        </script>

        <!-- AUTOFILL -->
        <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="../static/scripts/autofill-dropdown.js"></script>
        
        

    </body>
</html>

